{% load static %}

<link rel="stylesheet" href="{% static 'entrepreneur.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    .detail-box {
        background: white;
        padding: 25px;
        border-radius: 16px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.07);
        max-width: 950px;
        margin: auto;
    }

    .order-title {
        font-size: 24px;
        font-weight: 800;
        color: #E65100;
        margin-bottom: 15px;
    }

    .order-row {
        font-size: 16px;
        margin: 8px 0;
        display: flex;
        justify-content: space-between;
    }

    .slip-img {
        max-width: 380px;
        margin-top: 10px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border: 2px solid #FFB088;
    }

    .status-select {
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 16px;
        width: 220px;
    }

    .save-btn {
        background: #FF6A2E;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 700;
        margin-top: 12px;
    }

    .back-btn {
        margin-top: 25px;
        background: #888;
        color: white;
        padding: 10px 18px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 700;
        display: inline-block;
    }

    .item-table {
        width: 100%;
        margin-top: 15px;
        border-collapse: collapse;
    }

    .item-table th, .item-table td {
        padding: 10px;
        border-bottom: 1px solid #ddd;
    }

    .item-table th {
        background: #FFE6D5;
        color: #D35400;
        font-weight: 700;
    }
    
    /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à */
    .success-badge {
        background: #E8F5E9;
        color: #2E7D32;
        padding: 10px;
        border-radius: 8px;
        margin-top: 10px;
        font-weight: 600;
        border: 1px solid #A5D6A7;
    }
</style>


<div class="seller-layout">

    <aside class="seller-sidebar">
        <div class="seller-profile">
            {% if entrepreneur.profile_image %}
                <img src="{{ entrepreneur.profile_image.url }}" class="seller-avatar">
            {% else %}
                <img src="{% static 'images/‡∏£‡πâ‡∏≤‡∏ô.png' %}" class="seller-avatar">
            {% endif %}
            <h3 class="seller-name">{{ entrepreneur.store_name }}</h3>
            <p class="seller-username">@{{ entrepreneur.user.username }}</p>
        </div>

        <nav class="seller-menu">
            <a href="{% url 'petjoy:entrepreneur-home' %}">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏£‡πâ‡∏≤‡∏ô</a>
            <a class="active" href="{% url 'petjoy:orders-list' %}">üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</a>
            <a href="{% url 'petjoy:product-list' %}">üõçÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
            <a href="{% url 'petjoy:entrepreneur-chat-list' %}">üí¨ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</a>
            <a href="{% url 'petjoy:entrepreneur_profile_settings' %}">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏£‡πâ‡∏≤‡∏ô</a>
            <a href="{% url 'petjoy:entrepreneur_reviews' %}">üìã ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
            <a href="{% url 'petjoy:entrepreneur-income' %}">üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</a>
        </nav>

        <form method="post" action="{% url 'petjoy:logout' %}">
            {% csrf_token %}
            <button class="seller-logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </form>
    </aside>

    <main class="seller-main">

        <div class="detail-box">

            <h2 class="order-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ORD-{{ order.order_number|stringformat:"06d" }}</h2>

            <div class="order-row">
                <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> <span>{{ order.customer_name }}</span>
            </div>

            <div class="order-row">
                <strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> <span>{{ order.customer_phone }}</span>
            </div>

            <div class="order-row">
                <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</strong>
                <span>{{ order.customer_address }}</span>
            </div>

            <div class="order-row">
                <strong>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:</strong> <span>{{ order.total_price }} ‡∏ö‡∏≤‡∏ó</span>
            </div>

            <div class="order-row">
                <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</strong> <span>{{ order.created_at|date:"d/m/Y H:i" }}</span>
            </div>

            <hr style="margin: 20px 0;">

            <h3 style="font-weight:700; margin-bottom:10px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>

            {% if order.items.all %}
                <table class="item-table">
                    <tr>
                        <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                        <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                        <th>‡∏£‡∏ß‡∏°</th>
                    </tr>

                    {% for item in order.items.all %}
                        <tr>
                            <td>{{ item.product.name }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.price }} ‡∏ö‡∏≤‡∏ó</td>
                            <td>{{ item.total }} ‡∏ö‡∏≤‡∏ó</td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p style="color:#888;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
            {% endif %}

            <hr style="margin: 20px 0;">

            <h3 style="font-weight:700; margin-bottom:10px;">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>

            <form method="POST">
                {% csrf_token %}
                <select name="status" id="status-select" class="status-select">
                    <option value="waiting" {% if order.status == "waiting" %}selected{% endif %}>‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</option>
                    <option value="paid" {% if order.status == "paid" %}selected{% endif %}>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
                    <option value="preparing" {% if order.status == "preparing" %}selected{% endif %}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡∏≠‡∏á</option>
                    <option value="delivering" {% if order.status == "delivering" %}selected{% endif %}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
                    <option value="success" {% if order.status == "success" %}selected{% endif %}>‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</option>
                </select>

                <div id="tracking-input-container" style="margin-top: 15px; display: none;">
                    <label style="font-weight:700; display: block; margin-bottom: 5px;">‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏:</label>
                    <input type="text" name="tracking_number" value="{{ order.tracking_number|default:'' }}" class="status-select" style="width: 100%; max-width: 300px;" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
                </div>

                <div id="success-message-container" style="display: none;">
                    <div class="success-badge">
                        ‚úÖ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß 
                        {% if order.tracking_number %}
                            <br><small>‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏: {{ order.tracking_number }}</small>
                        {% endif %}
                    </div>
                </div>

                <button type="submit" class="save-btn" id="save-button">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
            </form>

            <hr style="margin: 20px 0;">

            <div id="slip-section-container">
                <h3 style="font-weight:700; margin-bottom:10px;">‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</h3>

                {% if order.slip_image %}
                    <img src="{{ order.slip_image.url }}" class="slip-img">
                {% else %}
                    <p style="color:#888;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ</p>
                {% endif %}
            </div>

            <a href="{% url 'petjoy:orders-list' %}" class="back-btn">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</a>

        </div>

    </main>

</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const statusSelect = document.getElementById('status-select');
        const trackingContainer = document.getElementById('tracking-input-container');
        const slipContainer = document.getElementById('slip-section-container');
        const successMessage = document.getElementById('success-message-container');

        function updateVisibility() {
            const status = statusSelect.value;

            // 1. ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏•‡∏¥‡∏õ: ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡∏≠‡∏á", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"
            if (status === 'preparing' || status === 'delivering' || status === 'success') {
                slipContainer.style.display = 'none';
            } else {
                slipContainer.style.display = 'block';
            }

            // 2. ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏: ‡πÇ‡∏ä‡∏ß‡πå‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á"
            if (status === 'delivering') {
                trackingContainer.style.display = 'block';
            } else {
                trackingContainer.style.display = 'none';
            }

            // 3. ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:
            if (status === 'success') {
                successMessage.style.display = 'block';
            } else {
                successMessage.style.display = 'none';
            }
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        updateVisibility();

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô Select
        statusSelect.addEventListener('change', updateVisibility);
    });
</script>