{% extends 'petjoy/base.html' %}

{% block content %}
<div class="container" style="max-width:900px; margin:40px auto;">

    <div style="display:flex; align-items:center; gap:12px; margin-bottom:30px;">
        <a href="{% url 'petjoy:homepage' %}"
           style="
               display:inline-flex;
               align-items:center;
               gap:6px;
               padding:10px 16px;
               background:#fff3eb;
               color:#ff7a00;
               border-radius:999px;
               font-size:14px;
               font-weight:600;
               text-decoration:none;
               border:1px solid #ffd2b8;
           ">
            <i class="ri-arrow-left-line"></i>
            ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
        </a>

        <h2 style="margin:0; font-size:22px;">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
    </div>

    {% if orders %}
        {% for order in orders %}
            
            {% if order.has_unread_status_update and order.reviews.exists %}
                {% for review in order.reviews.all %}
                    {% if review.reply %}
                    <a href="{% url 'petjoy:order_detail_customer' order.id %}" style="text-decoration:none; color:inherit;">
                        <div style="background:#fff3eb; border:1px solid #ffd2b8; padding:20px; border-radius:16px; margin-bottom:16px; box-shadow:0 4px 12px rgba(255,122,0,0.1);">
                            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                                <div>
                                    <strong style="color:#ff7a00; font-size:16px;">üí¨ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß</strong><br>
                                    <span style="font-size:14px; color:#555;">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: {{ review.product.name }}</span><br>
                                    <small style="color:#888;">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ORD-{{ order.order_number|stringformat:"06d" }}</small>
                                </div>
                                <span style="background:#ff7a00; color:#fff; font-size:10px; padding:2px 8px; border-radius:10px;">‡πÉ‡∏´‡∏°‡πà</span>
                            </div>
                        </div>
                    </a>
                    {% endif %}
                {% endfor %}
            {% endif %}

            {% if order.status == 'preparing' %}
            <div style="background:#fff;border-radius:16px;padding:20px 22px;margin-bottom:16px;
                        box-shadow:0 6px 18px rgba(0,0,0,0.06);display:flex;justify-content:space-between;align-items:center;">
                <div>
                    <strong>{{ order.display_title }}</strong><br>
                    <span style="color:#ffb000;font-weight:600;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span><br>
                    <small style="color:#aaa;">{{ order.created_at|date:"d M Y ‚Ä¢ H:i" }}</small>
                </div>
            </div>

            {% elif order.status == 'delivering' %}
            <div style="background:#fff;border-radius:16px;padding:20px 22px;margin-bottom:16px;
                        box-shadow:0 6px 18px rgba(0,0,0,0.06);display:flex;justify-content:space-between;align-items:center;">
                <div>
                    <strong>{{ order.display_title }}</strong><br>
                    <span style="color:#3b82f6;font-weight:600;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span><br>
                    {% if order.tracking_number %}
                        <small style="color:#555;">‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏: {{ order.tracking_number }}</small><br>
                    {% endif %}
                    <small style="color:#aaa;">{{ order.created_at|date:"d M Y ‚Ä¢ H:i" }}</small>
                </div>
            </div>

            {% elif order.status == 'success' %}
            <div style="background:#fff;border-radius:16px;padding:20px 22px;margin-bottom:16px;
                        box-shadow:0 6px 18px rgba(0,0,0,0.06);display:flex;justify-content:space-between;align-items:center;">
                <div>
                    <strong>{{ order.display_title }}</strong><br>
                    <span style="color:#22c55e;font-weight:600;">‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span><br>
                    <small style="color:#aaa;">{{ order.created_at|date:"d M Y ‚Ä¢ H:i" }}</small>
                </div>

                {% if not order.reviews.exists %}
                <a href="{% url 'petjoy:review_product' order.id %}"
                   style="padding:8px 16px;background:#ff7a00;color:#fff;
                          border-radius:999px;font-size:14px;text-decoration:none;">
                    ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </a>
                {% else %}
                <span style="color:#22c55e; font-size:14px;">
                    <i class="ri-checkbox-circle-fill"></i> ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÅ‡∏•‡πâ‡∏ß
                </span>
                {% endif %}
            </div>
            {% endif %}

        {% endfor %}
    {% else %}
        <div style="text-align:center; padding:60px 20px; background:#fff; border-radius:20px; box-shadow:0 4px 15px rgba(0,0,0,0.05);">
            <i class="ri-notification-off-line" style="font-size:48px; color:#ddd;"></i>
            <p style="color:#999; margin-top:15px; font-size:16px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>
        </div>
    {% endif %}

</div>
{% endblock %}