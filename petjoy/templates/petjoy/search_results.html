{% extends 'petjoy/base.html' %}
{% load static %}

{% block title %}ค้นหา - PetJoy{% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'search_results_new.css' %}">

<main class="search-page">

    <!-- HEADER -->
    <div class="search-header">
        <button class="back-btn" onclick="history.back()">‹</button>
        <h2>ค้นหา</h2>
        <div class="search-info">ผลการค้นหา: "<strong>{{ query }}</strong>"</div>
    </div>

    <div class="search-main-layout">

        <!-- LEFT: PRODUCT LIST -->
        <section class="product-section">

            <h3 class="section-title">สินค้าที่พบ ({{ products|length }})</h3>

            {% if products %}
            <div class="product-grid">
                {% for product in products %}
                <article class="product-card">

                    <a href="{% url 'petjoy:product-detail' product.id %}" class="product-img-box">
                        {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}">
                        {% else %}
                            <img src="{% static 'images/Cat teaser.jpg' %}" alt="placeholder">
                        {% endif %}
                    </a>

                    <div class="product-details">

                        <h4 class="product-name">{{ product.name }}</h4>

                        {% if product.price %}
                        <div class="product-price">฿{{ product.price }}</div>
                        {% endif %}

                        <form method="post" action="{% url 'petjoy:cart-add' %}">
                            {% csrf_token %}
                            <input type="hidden" name="product_id" value="{{ product.id }}">
                            <input type="hidden" name="quantity" value="1">
                            <button 
                                class="add-cart-btn"
                                data-logged-in="{% if user.is_authenticated %}1{% else %}0{% endif %}">
                                เพิ่มลงตะกร้า
                            </button>
                        </form>

                    </div>

                </article>
                {% endfor %}
            </div>

            {% else %}
            <div class="no-results">
                <img src="{% static 'images/no-result.png' %}" alt="No results">
                <p>ไม่พบสินค้า</p>
            </div>
            {% endif %}

        </section>

        <!-- RIGHT: SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-box">
                <h4>หมวดหมู่ที่เกี่ยวข้อง</h4>

                {% if categories %}
                <ul class="category-list">
                    {% for cat in categories %}
                    <li>{{ cat.display_name }}</li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="sidebar-empty">ไม่มีหมวดหมู่ที่เกี่ยวข้อง</p>
                {% endif %}
            </div>
        </aside>

    </div>
</main>

<!-- SweetAlert + JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{% static 'js/search_results.js' %}"></script>

{% endblock %}
