{% extends 'petjoy/admin/admin_base.html' %}
{% load static %}
{% block nav_chat %}active{% endblock %}
{% block title %}‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤{% endblock %}
{% block page_title %}üí¨ ‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤{% endblock %}

{% block content %}
<div class="admin-card">
    <div class="admin-card-header">
        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤</h3>
    </div>

    <div class="admin-table-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                    <th>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                    <th style="width: 180px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody>
                {% for room in rooms %}
                <tr>
                    <td>
                        <div style="display:flex; align-items:center; gap:10px;">
                            {% if room.entrepreneur.profile_image %}
                                <img src="{{ room.entrepreneur.profile_image.url }}" style="width:40px; height:40px; border-radius:50%; object-fit:cover;">
                            {% else %}
                                <div style="width:40px; height:40px; border-radius:50%; background:#ddd;"></div>
                            {% endif %}
                            <div>
                                <strong>{{ room.entrepreneur.store_name }}</strong><br>
                                <small style="color:#777;">{{ room.entrepreneur.owner_name }}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        {% with room.messages.last as last_msg %}
                            {% if last_msg %}
                                {{ last_msg.message|truncatechars:50 }} 
                                <span style="color:#999; font-size:0.8em;">({{ last_msg.timestamp|timesince }})</span>
                            {% else %}
                                -
                            {% endif %}
                        {% endwith %}
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <a href="{% url 'petjoy:admin-chat-room' room.id %}" class="btn-action view" style="flex:1; text-align:center;">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó</a>
                            
                            <form method="post" action="{% url 'petjoy:admin-delete-chat' room.id %}" onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó‡∏ô‡∏µ‡πâ? (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏≤‡∏ß‡∏£)');" style="margin:0;">
                                {% csrf_token %}
                                <button type="submit" class="btn-action danger" style="padding: 6px 10px;">
                                    üóëÔ∏è
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}