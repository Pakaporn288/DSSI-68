{% extends "petjoy/admin/admin_base.html" %}
{% load static %}

{% block title %}โปรไฟล์ผู้ใช้งาน{% endblock %}
{% block page_title %}ดูโปรไฟล์ผู้ใช้งาน{% endblock %}

{% block content %}

<div class="admin-card">

    <div class="admin-card-header">
        <h3>ข้อมูลผู้ใช้งาน</h3>

        <a href="{% url 'petjoy:admin-users' %}"
           class="btn-action view">
            ← กลับหน้าจัดการผู้ใช้งาน
        </a>
    </div>

    <div style="padding: 10px 0;">

        {% if not profile_user.is_superuser and not entrepreneur %}
            <div style="text-align:center; margin-bottom: 25px;">
                {% if user_profile.image %}
                    <img src="{{ user_profile.image.url }}"
                         style="width:140px; height:140px; border-radius:50%; object-fit:cover; border: 4px solid #f0f0f0; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
                {% else %}
                    <img src="{% static 'images/user_default.png' %}"
                         style="width:140px; height:140px; border-radius:50%; object-fit:cover; border: 4px solid #f0f0f0; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
                {% endif %}
            </div>
        {% endif %}

        <div>
            <table class="admin-table">
                <tr>
                    <th style="width: 250px;">Username</th>
                    <td>{{ profile_user.username }}</td>
                </tr>
                <tr>
                    <th>Email</th>
                    <td>{{ profile_user.email|default:"-" }}</td>
                </tr>
                <tr>
                    <th>ประเภทผู้ใช้</th>
                    <td>
                        {% if profile_user.is_superuser %}
                            <span class="badge admin">แอดมิน</span>
                        {% elif entrepreneur %}
                            <span class="badge shop">ผู้ประกอบการ</span>
                        {% else %}
                            <span class="badge user">ผู้ใช้งานทั่วไป</span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>สถานะบัญชี</th>
                    <td>
                        {% if user_profile.is_banned %}
                            <span class="status banned">ถูกระงับ</span>
                        {% elif profile_user.is_active %}
                            <span class="status active">ใช้งาน</span>
                        {% else %}
                            <span class="status banned">Inactive</span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>วันที่สมัคร</th>
                    <td>{{ profile_user.date_joined|date:"d/m/Y H:i" }}</td>
                </tr>
                <tr>
                    <th>เข้าใช้งานล่าสุด</th>
                    <td>
                        {% if profile_user.last_login %}
                            {{ profile_user.last_login|date:"d/m/Y H:i" }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>
    </div>

    {% if entrepreneur %}
    <hr style="margin:30px 0; border-top: 1px solid #eee;">

    <h3 style="margin-bottom:20px; color: #FF6A2E;">ข้อมูลร้านค้า</h3>

    <div style="display: flex; align-items: flex-start; gap: 20px;">
        {% if entrepreneur.profile_image %}
            <div style="flex-shrink: 0;">
                <img src="{{ entrepreneur.profile_image.url }}" 
                     style="width: 100px; height: 100px; border-radius: 12px; object-fit: cover; border: 1px solid #ddd;">
            </div>
        {% else %}
             <div style="flex-shrink: 0;">
                <img src="{% static 'images/ร้าน.png' %}" 
                     style="width: 100px; height: 100px; border-radius: 12px; object-fit: cover; border: 1px solid #ddd;">
            </div>
        {% endif %}

        <table class="admin-table" style="flex-grow: 1;">
            <tr>
                <th style="width: 250px;">ชื่อร้าน</th>
                <td>{{ entrepreneur.store_name }}</td>
            </tr>
            <tr>
                <th>เจ้าของร้าน</th>
                <td>{{ entrepreneur.owner_name|default:"-" }}</td>
            </tr>
            <tr>
                <th>เบอร์โทร</th>
                <td>{{ entrepreneur.phone|default:"-" }}</td>
            </tr>
            <tr>
                <th>ที่อยู่ร้าน</th>
                <td>{{ entrepreneur.shop_address|default:"-" }}</td>
            </tr>
            <tr>
                <th>เลขประจำตัวผู้เสียภาษี</th>
                <td>{{ entrepreneur.tax_id|default:"-" }}</td>
            </tr>
        </table>
    </div>
    {% endif %}

    <div style="margin-top:40px; text-align: right;" class="action-buttons">
        
        {% if user_profile.is_banned %}
            <a href="{% url 'petjoy:admin-toggle-ban' profile_user.id %}" class="btn-action success" style="background-color: #28a745; color: white;">
               ปลดระงับบัญชี
            </a>
        {% else %}
            <a href="{% url 'petjoy:admin-toggle-ban' profile_user.id %}" class="btn-action warn">
               ระงับบัญชี
            </a>
        {% endif %}

        <a href="{% url 'petjoy:admin-delete-user' profile_user.id %}" 
           class="btn-action danger"
           onclick="return confirm('คุณแน่ใจหรือไม่ที่จะลบบัญชีนี้? ข้อมูลทั้งหมดรวมถึงร้านค้า (ถ้ามี) จะหายไปถาวร');">
           ลบบัญชี
        </a>
    </div>

</div>

{% endblock %}