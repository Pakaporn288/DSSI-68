{% extends 'petjoy/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}PetJoy{% endblock %}

{% block content %}

    <!-- ============================
         GREETING
    ================================ -->
    <div class="hello-banner">
        <div class="hello-left">
            <h1>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ {{ request.user.first_name|default:"‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏Å" }}</h1>
            <p>‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏ô‡πâ‡∏≠‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞ ‚ù§Ô∏è</p>
        </div>
        <img src="{% static 'images/‡∏•‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á.png' %}" class="hello-img" alt="pet">
    </div>

    <!-- ============================
         CATEGORY
    ================================ -->
    <section class="pet-selection">
        <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏Å‡πä‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
        <div class="pet-options">

            {% for cat in categories %}
                <a href="{% url 'petjoy:category-products' cat.id %}" class="pet-card">
                    <div class="pet-image-container">
                        {% if cat.image %}
                            <img src="{{ cat.image.url }}">
                        {% else %}
                            <img src="{% static 'images/default.png' %}">
                        {% endif %}
                    </div>
                    <span>{{ cat.display_name }}</span>
                </a>
            {% endfor %}

        </div>
    </section>

    <!-- ============================
         RECOMMENDED PRODUCTS
    ================================ -->
    <section class="recommend-products">
        <h3 class="recommend-title">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>

        <div class="products-grid small-grid">

            {% for product in products|slice:":6" %}
            <div class="product-item small-card">

                <div class="product-image-placeholder small-img">
                    {% if product.image %}
                        <img src="{{ product.image.url }}" class="product-image">
                    {% else %}
                        <img src="{% static 'images/no-image.png' %}" class="product-image">
                    {% endif %}
                </div>

                <div class="product-name small-name">
                    {{ product.name }}
                </div>

                <div class="product-price small-price">
                    {{ product.price|floatformat:0|intcomma }} ‡∏ö‡∏≤‡∏ó
                </div>

                <div class="product-actions">
                    <form method="POST" action="{% url 'petjoy:cart-add' %}">
                        {% csrf_token %}
                        <input type="hidden" name="product_id" value="{{ product.id }}">
                        <input type="hidden" name="quantity" value="1">
                        <button type="submit" class="add-cart-btn nice-btn">
                            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                        </button>
                    </form>

                    <a href="{% url 'petjoy:product-detail' product.id %}"
                       class="detail-btn">
                        ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                    </a>
                </div>

            </div>
            {% empty %}
                <p style="text-align:center;color:#777;">
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                </p>
            {% endfor %}

        </div>
    </section>

<!-- ============================
     CHATBOT
=============================== -->
<style>
        /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó: ‡∏à‡∏±‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏õ‡πä‡∏∞‡πÜ ‡∏î‡πâ‡∏ß‡∏¢ Flexbox */
        .chatbot-toggle-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ffffff, #ff6b00);
            border: none;
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 9999;
            /* Flexbox ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            transition: transform 0.2s;
            padding: 0; /* ‡∏•‡∏ö padding ‡∏Å‡∏±‡∏ô‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß */
        }
        .chatbot-toggle-button:hover { transform: scale(1.1); }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏ä‡∏ó */
        .chatbot-popup {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 340px;
            height: 480px;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 9998;
            font-family: 'Sarabun', sans-serif;
            border: 1px solid #eee;
        }
        .hidden { display: none !important; }

        .chatbot-header {
            background: linear-gradient(135deg, #ff6b00, #FECFEF);
            padding: 15px;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chatbot-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #fcfcfc;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á */
        .msg-wrapper {
            display: flex;
            align-items: flex-start; /* ‡πÉ‡∏´‡πâ Avatar ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏™‡∏°‡∏≠‡∏Ç‡∏≠‡∏ö‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
            gap: 10px;
            width: 100%;
        }
        .msg-wrapper.user { justify-content: flex-end; }
        
        /* Avatar ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô */
        .chat-avatar {
            width: 35px; height: 35px;
            background: #fff; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex-shrink: 0;
            margin-top: 2px; /* ‡∏î‡∏±‡∏ô‡∏•‡∏á‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å */
        }

        .bot-msg, .user-msg {
            padding: 10px 14px;
            border-radius: 15px;
            font-size: 0.95rem;
            line-height: 1.5;
            max-width: 75%;
            word-wrap: break-word;
            position: relative;
        }

        .bot-msg {
            background: #fff; color: #333;
            border-radius: 0 15px 15px 15px; /* ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô‡πÅ‡∏´‡∏•‡∏°‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏´‡∏≤ Avatar */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid #f0f0f0;
        }

        .user-msg {
            background: #e6819a; color: white;
            border-radius: 15px 0 15px 15px; /* ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô‡πÅ‡∏´‡∏•‡∏°‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏´‡∏≤ Avatar ‡πÄ‡∏£‡∏≤ */
            box-shadow: 0 2px 5px rgba(255, 143, 163, 0.4);
        }

        /* ‡∏à‡∏±‡∏î Format ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô */
        .bot-msg strong { color: #d63384; font-weight: 700; }
        .chat-list { padding-left: 20px; margin: 5px 0; }
        
        /* ‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå */
        .chatbot-input-area {
            padding: 10px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 8px;
            background: #fff;
            align-items: center;
        }
        #chatbot-input {
            flex: 1;
            padding: 10px 15px;
            border-radius: 20px;
            border: 1px solid #ddd;
            outline: none;
        }
        #chatbot-input:focus { border-color: #FF9A9E; }
        #chatbot-send {
            background: #FF9A9E; color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
        }

        /* Animation ‡∏à‡∏∏‡∏î ... */
        .typing-indicator span {
            display: inline-block; width: 5px; height: 5px;
            background-color: #aaa; border-radius: 50%;
            animation: typing 1s infinite; margin: 0 2px;
        }
        @keyframes typing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
    </style>

    <div id="chatbot-container" class="chatbot-popup hidden">
        <div class="chatbot-header">
            <span>üêæ ‡∏ô‡πâ‡∏≠‡∏á Joy ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</span>
        </div>
        <div class="chatbot-body" id="chat-response">
            <div class="msg-wrapper bot">
                <div class="chat-avatar">üê∂</div>
                <div class="bot-msg">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ üëã ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏á Joy ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?</div>
            </div>
        </div>
        <div class="chatbot-input-area">
            <input type="text" id="chatbot-input" placeholder="‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." autocomplete="off"/>
            <button id="chatbot-send">‡∏™‡πà‡∏á</button>
        </div>
    </div>

    <button class="chatbot-toggle-button">üí¨</button>

{% endblock %}
