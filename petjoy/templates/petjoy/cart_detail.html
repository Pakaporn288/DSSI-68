{% extends 'petjoy/base.html' %}
{% load static %}
{% block title %}‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | PetJoy{% endblock %}
{% block content %}
<div class="cart-container">

    <h1 class="cart-title">
        üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    </h1>

    {% if cart_items %}
        <div class="cart-items-list">

            {% for item in cart_items %}
            <div class="cart-item-card">

                <div class="cart-item-left">
                    <a href="{% url 'petjoy:product-detail' item.product.id %}" class="cart-img-link">
                        {% if item.product.image %}
                            <img src="{{ item.product.image.url }}" class="cart-img" alt="{{ item.product.name }}">
                        {% else %}
                            <img src="{% static 'images/no-image.png' %}" class="cart-img" alt="{{ item.product.name }}">
                        {% endif %}
                    </a>
                </div>

                <div class="cart-item-right">

                    <h2 class="cart-item-name">
                        <a href="{% url 'petjoy:product-detail' item.product.id %}" class="cart-item-name-link">
                            {{ item.product.name }}
                        </a>
                    </h2>

                    <p class="cart-item-price">
                        ‡∏£‡∏≤‡∏Ñ‡∏≤: {{ item.product.price }} ‡∏ö‡∏≤‡∏ó
                    </p>

                    <div class="qty-controls">
                        <form method="POST" action="{% url 'petjoy:update-cart' %}">
                            {% csrf_token %}
                            <input type="hidden" name="item_id" value="{{ item.id }}">
                            <input type="hidden" name="quantity" value="{{ item.quantity|add:'-1' }}">
                            <button type="submit" class="qty-btn">-</button>
                        </form>

                        <span class="qty-number">{{ item.quantity }}</span>

                        <form method="POST" action="{% url 'petjoy:update-cart' %}">
                            {% csrf_token %}
                            <input type="hidden" name="item_id" value="{{ item.id }}">
                            <input type="hidden" name="quantity" value="{{ item.quantity|add:'1' }}">
                            <button type="submit" class="qty-btn">+</button>
                        </form>
                    </div>

                    <p class="cart-item-total">
                        ‡∏£‡∏ß‡∏°: <span>{{ item.total_price }}</span> ‡∏ö‡∏≤‡∏ó
                    </p>

                    <div class="cart-item-actions">
                        <a href="{% url 'petjoy:product-detail' item.product.id %}" class="btn-order-single">
                            ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ
                        </a>

                        <a href="{% url 'petjoy:remove-from-cart' item.id %}" class="btn-remove">
                            ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                        </a>
                    </div>

                </div>
            </div>
            {% endfor %}
        </div>

        <div class="cart-summary smaller-summary">
            <h2>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
            <p class="total-items">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: {{ total_items }} ‡∏ä‡∏¥‡πâ‡∏ô</p>
            <p class="total-price small-price">{{ total_price }} ‡∏ö‡∏≤‡∏ó</p>

            <button class="btn-checkout small-checkout" id="openCheckoutPopup">
                ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
            </button>
        </div>

    {% else %}
        <p class="cart-empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
    {% endif %}

</div>


<!-- ==========================================
     CHECKOUT POPUP
=========================================== -->
<div id="checkoutPopup" class="popup-overlay">
    <div class="popup-box">

        <h2 class="popup-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>

        <form id="checkoutForm">

            <div class="popup-items">
                {% for item in cart_items %}
                <label class="popup-item">
                    <input type="checkbox" name="selected_items" value="{{ item.id }}" class="popup-checkbox">

                    <img src="{{ item.product.image.url }}" class="popup-img">

                    <div class="popup-info">
                        <p class="popup-name">{{ item.product.name }}</p>
                        <p class="popup-price">{{ item.product.price }} ‡∏ö‡∏≤‡∏ó √ó {{ item.quantity }}</p>
                    </div>
                </label>
                {% endfor %}
            </div>

            <div class="popup-actions">
                <button type="button" id="cancelPopup" class="popup-cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button type="submit" class="popup-confirm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
            </div>

        </form>

    </div>
</div>


<!-- ==========================================
     JAVASCRIPT
=========================================== -->
<script>
document.getElementById("openCheckoutPopup").addEventListener("click", () => {
    document.getElementById("checkoutPopup").style.display = "flex";
});

document.getElementById("cancelPopup").addEventListener("click", () => {
    document.getElementById("checkoutPopup").style.display = "none";
});

document.getElementById("checkoutForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const selected = [...document.querySelectorAll("input[name='selected_items']:checked")]
        .map(el => el.value);

    if (selected.length === 0) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
        return;
    }

    console.log("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:", selected);

    alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡πÑ‡∏õ backend ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ)");
});
</script>

{% endblock %}
